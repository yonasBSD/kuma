import{d as at,a1 as et,r as c,p as y,o,w as a,b as n,m as z,a2 as nt,e,c as r,L as f,M as k,q as x,l as i,t as l,S as ot,N as O,a3 as V,y as st,_ as it}from"./index-D9fsUKAU.js";import{T as dt}from"./TagList-s_5JxIRL.js";import{C as P,a as q,b as A}from"./ConnectionTraffic-rkbyvJAn.js";const lt={key:0},rt={key:1},pt={key:2},ut={key:0},mt={key:0},ft={key:1},yt={key:2},ct=at({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(F){const T=et(),s=F;return(gt,t)=>{const I=c("XI18n"),B=c("XNotification"),$=c("XIcon"),R=c("DataCollection"),b=c("XLayout"),X=c("XAction"),_=c("XBadge"),M=c("XCopyButton"),S=c("XDl"),G=c("DataLoader"),K=c("XAboutCard"),j=c("XEmptyState"),U=c("XInputSwitch"),Z=c("XProgress"),H=c("XCard"),J=c("XDrawer"),Q=c("RouterView"),W=c("AppView"),Y=c("DataSource"),L=c("RouteView");return o(),y(L,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:a(({route:g,t:u,can:N,uri:h})=>[n(Y,{src:h(z(nt),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[g.params.proxyType]??"dataplane",name:g.params.proxy,mesh:g.params.mesh||"*",socketAddress:s.data.dataplane.networking.inboundAddress})},{default:a(({data:C,error:E,refresh:tt})=>[n(W,{notifications:!0},{default:a(()=>[n(B,{notify:!!E,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${s.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.stats-not-enhanced",params:{error:E?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[56]||(t[56]=e()),(o(!0),r(f,null,k([{bool:s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:s.data.dataplaneInsight.version?.envoy.version??"",kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(N("use zones")&&s.data.zone&&s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!N("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:d,key:p,params:m,variant:v})=>(o(),y(B,{key:p,notify:d,"data-testid":`warning-${p}`,uri:`data-planes.notifications.${p}.${s.data.id}`,variant:v},{default:a(()=>[n(I,{path:`data-planes.notifications.${p}`,params:Object.fromEntries(Object.entries(m??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[57]||(t[57]=e()),n(b,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(K,{title:u("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section","data-testid":"dataplane-about-section"},{default:a(()=>[n(G,{data:[C]},{default:a(()=>[n(b,null,{default:a(()=>[n(S,{variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,l(u("http.api.property.status")),1),t[1]||(t[1]=e()),i("dd",null,[n(b,{type:"separated"},{default:a(()=>[n(ot,{status:s.data.status},null,8,["status"]),t[0]||(t[0]=e()),n(R,{items:s.data.dataplane.networking.inbounds,predicate:d=>d.state!=="Ready",empty:!1},{default:a(({items:d})=>[n($,{name:"info"},{default:a(()=>[i("ul",null,[(o(!0),r(f,null,k(d,p=>(o(),r("li",{key:`${p.service}:${p.port}`},l(u("data-planes.routes.item.unhealthy_inbound",{port:p.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[8]||(t[8]=e()),N("use zones")&&s.data.zone?(o(),r("div",lt,[i("dt",null,l(u("http.api.property.zone")),1),t[2]||(t[2]=e()),i("dd",null,[n(_,{appearance:"decorative"},{default:a(()=>[n(X,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:a(()=>[e(l(s.data.zone),1)]),_:1},8,["to"])]),_:1})])])):x("",!0),t[9]||(t[9]=e()),i("div",null,[i("dt",null,l(u("http.api.property.type")),1),t[3]||(t[3]=e()),i("dd",null,[n(_,{appearance:"decorative"},{default:a(()=>[e(l(u(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)])]),t[10]||(t[10]=e()),s.data.namespace.length>0?(o(),r("div",rt,[i("dt",null,l(u("http.api.property.namespace")),1),t[4]||(t[4]=e()),i("dd",null,[n(_,{appearance:"decorative"},{default:a(()=>[e(l(s.data.namespace),1)]),_:1})])])):x("",!0),t[11]||(t[11]=e()),i("div",null,[i("dt",null,l(u("http.api.property.address")),1),t[5]||(t[5]=e()),i("dd",null,[n(M,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])])]),t[12]||(t[12]=e()),s.data.dataplane.networking.gateway?(o(),r("div",pt,[i("dt",null,l(u("http.api.property.tags")),1),t[6]||(t[6]=e()),i("dd",null,[n(dt,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):x("",!0),t[13]||(t[13]=e()),(o(!0),r(f,null,k([Object.entries(s.data.labels)],d=>(o(),r(f,{key:typeof d},[d.length>0?(o(),r("div",ut,[i("dt",null,l(u("data-planes.routes.item.labels")),1),t[7]||(t[7]=e()),i("dd",null,[n(b,{variant:"separated",truncate:""},{default:a(()=>[(o(),r(f,null,k([/^(.+\.)?kuma\.io\//],p=>(o(),r(f,{key:typeof p},[(o(!0),r(f,null,k(d,([m,v])=>(o(),y(_,{key:m,appearance:p.test(m)?"info":"decorative"},{default:a(()=>[e(l(m)+":"+l(v),1)]),_:2},1032,["appearance"]))),128))],64))),64))]),_:2},1024)])])):x("",!0)],64))),128))]),_:2},1024),t[33]||(t[33]=e()),s.data.dataplaneInsight.mTLS?(o(),y(b,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[i("h3",null,l(u("data-planes.routes.item.mtls.title")),1),t[25]||(t[25]=e()),n(b,{size:"small"},{default:a(()=>[(o(!0),r(f,null,k([s.data.dataplaneInsight.mTLS],d=>(o(),r(f,{key:typeof d},[typeof d.lastCertificateRegeneration<"u"&&typeof d.certificateExpirationTime<"u"&&typeof d.issuedBackend<"u"?(o(),y(S,{key:0,variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,l(u("data-planes.routes.item.mtls.generation_time.title")),1),t[14]||(t[14]=e()),i("dd",null,[n(_,{appearance:"neutral"},{default:a(()=>[e(l(u("common.formats.datetime",{value:Date.parse(d.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[16]||(t[16]=e()),i("div",null,[i("dt",null,l(u("data-planes.routes.item.mtls.expiration_time.title")),1),t[15]||(t[15]=e()),i("dd",null,[n(_,{appearance:"neutral"},{default:a(()=>[e(l(u("common.formats.datetime",{value:Date.parse(d.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(o(),r(f,{key:1},[n(I,{path:"data-planes.routes.item.mtls.managed_externally"}),t[18]||(t[18]=e()),typeof C?.$meta?.tls?.certificateExpirationTime<"u"?(o(),y(S,{key:0,variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,l(u("data-planes.routes.item.mtls.expiration_time.title")),1),t[17]||(t[17]=e()),i("dd",null,[n(_,{appearance:"neutral"},{default:a(()=>[e(l(u("common.formats.datetime",{value:C?.$meta?.tls?.certificateExpirationTime})),1)]),_:2},1024)])])]),_:2},1024)):x("",!0)],64)),t[24]||(t[24]=e()),n(S,{variant:"x-stack"},{default:a(()=>[typeof d.certificateRegenerations<"u"?(o(),r("div",mt,[i("dt",null,l(u("data-planes.routes.item.mtls.regenerations.title")),1),t[19]||(t[19]=e()),i("dd",null,[n(_,{appearance:"info"},{default:a(()=>[e(l(u("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024)])])):x("",!0),t[22]||(t[22]=e()),typeof d.issuedBackend<"u"?(o(),r("div",ft,[i("dt",null,l(u("data-planes.routes.item.mtls.issued_backend.title")),1),t[20]||(t[20]=e()),i("dd",null,[n(_,{appearance:"decorative"},{default:a(()=>[e(l(d.issuedBackend),1)]),_:2},1024)])])):x("",!0),t[23]||(t[23]=e()),typeof d.supportedBackends<"u"?(o(),r("div",yt,[i("dt",null,l(u("data-planes.routes.item.mtls.supported_backends.title")),1),t[21]||(t[21]=e()),i("dd",null,[n(b,{type:"separated",truncate:""},{default:a(()=>[(o(!0),r(f,null,k(d.supportedBackends,p=>(o(),y(_,{key:p,appearance:p===d.issuedBackend?"decorative":"info"},{default:a(()=>[e(l(p),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):x("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):x("",!0),t[34]||(t[34]=e()),s.data.dataplaneInsight.subscriptions.length>0?(o(),y(b,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(b,{type:"separated"},{default:a(()=>[i("h3",null,l(u("data-planes.routes.item.subscriptions.title")),1),t[26]||(t[26]=e()),n(X,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:g.params.mesh,proxy:g.params.proxy},query:{inactive:g.params.inactive}}},{default:a(()=>[e(`
                      (`+l(u("data-planes.routes.item.xds.show-details"))+`)
                    `,1)]),_:2},1032,["to"])]),_:2},1024),t[32]||(t[32]=e()),s.data.dataplaneInsight.connectedSubscription?(o(),y(S,{key:0,variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,l(u("data-planes.routes.item.xds.connected")),1),t[27]||(t[27]=e()),i("dd",null,[n(_,{appearance:"neutral"},{default:a(()=>[e(l(u("common.formats.datetime",{value:Date.parse(s.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[30]||(t[30]=e()),i("div",null,[i("dt",null,l(u("data-planes.routes.item.xds.instance")),1),t[28]||(t[28]=e()),i("dd",null,[n(_,null,{default:a(()=>[e(l(s.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[31]||(t[31]=e()),i("div",null,[i("dt",null,l(u("data-planes.routes.item.xds.version")),1),t[29]||(t[29]=e()),i("dd",null,[n(_,null,{default:a(()=>[e(l(s.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??u("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(o(),y(I,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):x("",!0)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["title","created","modified"]),t[54]||(t[54]=e()),n(H,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(b,{type:"columns"},{default:a(()=>[n(P,null,{title:a(()=>[n(b,{type:"separated"},{default:a(()=>[n($,{name:"inbound"}),t[35]||(t[35]=e()),t[36]||(t[36]=i("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[40]||(t[40]=e()),(o(!0),r(f,null,k([s.data.dataplane.networking.type==="gateway"?Object.entries(C?.inbounds??{}).reduce((d,[p,m])=>{const v=p.split("_").at(-1);return v===String(s.data.dataplane.networking.admin?.port??9901)?d:d.concat([{...s.data.dataplane.networking.inbounds[0],name:p,clusterName:p,port:Number(v),protocol:["http","tcp"].find(w=>typeof m[w]<"u")??"tcp",addressPort:`${s.data.dataplane.networking.inbounds[0].address}:${v}`}])},[]):s.data.dataplane.networking.inbounds],d=>(o(),y(q,{key:typeof d,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(R,{type:"inbounds",items:d,predicate:p=>p.port!==49151},O({default:a(({items:p})=>[n(b,{type:"stack",size:"small"},{default:a(()=>[(o(!0),r(f,null,k(p,m=>(o(),r(f,{key:`${m.name}`},[(o(!0),r(f,null,k([C?.inbounds[m.clusterName]],v=>(o(),y(A,{key:typeof v,"data-testid":"dataplane-inbound",protocol:m.protocol,"port-name":m.portName,service:N("use service-insights",s.mesh)?m.tags["kuma.io/service"]:"",traffic:typeof E>"u"?v:{name:"",protocol:m.protocol,port:`${m.port}`},"data-actionable":""},{state:a(()=>[m.state!=="Ready"?(o(),y($,{key:0,name:"danger",size:z(V),placement:"right"},{default:a(()=>[e(l(u("data-planes.routes.item.unhealthy_inbound",{port:m.port})),1)]),_:2},1032,["size"])):(o(!0),r(f,{key:1},k([v?.$meta.alerts.reports??[]],w=>(o(),r(f,{key:typeof w},[n(B,{notify:w.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${s.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[37]||(t[37]=e()),w.length?(o(),y(X,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:m.clusterName},query:{codeSearch:w.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n($,{name:"warning",size:z(V),placement:"right"},null,8,["size"])]),_:1},8,["to"])):x("",!0)],64))),128))]),default:a(()=>[t[38]||(t[38]=e()),n(X,{"data-action":"",to:{name:(w=>w.includes("bound")?w.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(z(T).name)),params:{connection:m.name},query:{inactive:g.params.inactive}}},{default:a(()=>[e(l(m.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[n(j,null,{default:a(()=>[i("p",null,`
                            This proxy is a delegated gateway therefore `+l(u("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),t[53]||(t[53]=e()),n(P,null,O({title:a(()=>[n(b,{type:"separated"},{default:a(()=>[n($,{name:"outbound"}),t[44]||(t[44]=e()),t[45]||(t[45]=i("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[51]||(t[51]=e()),t[52]||(t[52]=e()),typeof E>"u"?(o(),r(f,{key:0},[typeof C>"u"?(o(),y(Z,{key:0})):(o(),r(f,{key:1},[n(q,{type:"passthrough"},{default:a(()=>[n(A,{protocol:"passthrough",traffic:C.passthrough},{default:a(()=>[...t[46]||(t[46]=[e(`
                        Non mesh traffic
                      `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[50]||(t[50]=e()),(o(),r(f,null,k(["upstream"],d=>(o(),r(f,{key:d},[n(B,{notify:!!Object.values(C.outbounds).find(p=>(typeof p.tcp<"u"?p.tcp?.[`${d}_cx_rx_bytes_total`]:p.http?.[`${d}_rq_total`])??!1),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${s.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.recommend-reachable",params:{mode:s.mesh.meshServices.mode}},null,8,["params"])]),_:1},8,["notify","uri"]),t[49]||(t[49]=e()),n(R,{type:"outbounds",predicate:g.params.inactive?void 0:([p,m])=>((typeof m.tcp<"u"?m.tcp?.[`${d}_cx_rx_bytes_total`]:m.http?.[`${d}_rq_total`])??0)>0,items:Object.entries(C.outbounds)},{default:a(({items:p})=>[p.length>0?(o(),y(q,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[(o(),r(f,null,k([/-([a-f0-9]){16}$/],m=>n(b,{key:typeof m,type:"stack",size:"small"},{default:a(()=>[(o(!0),r(f,null,k(p,([v,w])=>(o(),y(A,{key:`${v}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(D=>typeof w[D]<"u")??"tcp",traffic:w,service:w.$resourceMeta.type===""?v.replace(m,""):void 0,direction:d,"data-actionable":""},{state:a(()=>[(o(!0),r(f,null,k([w.$meta.alerts.reports??[]],D=>(o(),r(f,{key:typeof D},[n(B,{notify:D.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${s.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[47]||(t[47]=e()),D.length>0?(o(),y(X,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:v},query:{codeSearch:D.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n($,{name:"warning",size:z(V),placement:"right"},null,8,["size"])]),_:1},8,["to"])):x("",!0)],64))),128))]),default:a(()=>[t[48]||(t[48]=e()),n(X,{"data-action":"",to:{name:(D=>D.includes("bound")?D.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(z(T).name)),params:{connection:v},query:{inactive:g.params.inactive}}},{default:a(()=>[e(l(v),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):x("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(o(),y(j,{key:1}))]),_:2},[C?{name:"actions",fn:a(()=>[n(U,{checked:g.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:d=>g.update({inactive:d})},{label:a(()=>[...t[41]||(t[41]=[e(`
                      Show inactive
                    `,-1)])]),_:1},8,["checked","onChange"]),t[43]||(t[43]=e()),n(X,{action:"refresh",appearance:"primary",onClick:tt},{default:a(()=>[...t[42]||(t[42]=[e(`
                    Refresh
                  `,-1)])]),_:1},8,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),t[55]||(t[55]=e()),n(Q,null,{default:a(d=>[d.route.name!==g.name?(o(),y(J,{key:0,width:"670px",onClose:function(){g.replace({name:"data-plane-detail-view",params:{mesh:g.params.mesh,proxy:g.params.proxy},query:{inactive:g.params.inactive?null:void 0}})}},{default:a(()=>[(o(),y(st(d.Component),{data:g.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:d.route.name.includes("-inbound-")?s.data.dataplane.networking.inbounds:C?.outbounds||{},networking:s.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):x("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),wt=it(ct,[["__scopeId","data-v-e524b7c7"]]);export{wt as default};
