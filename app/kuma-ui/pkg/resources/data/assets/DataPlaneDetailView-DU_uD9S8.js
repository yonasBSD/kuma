import{d as ot,a1 as st,r as k,p as m,o,w as a,b as n,m as D,a2 as dt,c as i,e,L as u,M as x,q as g,l as s,t as d,S as lt,v as it,F as rt,P as pt,Z as ut,a3 as P,a8 as G,y as mt,_ as ft}from"./index-C3gcfku-.js";import{T as yt}from"./TagList-CD0IRUr3.js";import{C as H,a as F,b as Z}from"./ConnectionTraffic-BvMOLaGn.js";const vt={key:0},kt={key:1},gt={key:2},bt={key:0},xt={key:0},wt={key:1},Ct={key:2},Dt={key:0},It={key:1},zt={key:0},Xt={key:1},ct=ot({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(J){const K=st(),l=J,V=it();return(Nt,t)=>{const R=k("XI18n"),S=k("XNotification"),B=k("XIcon"),M=k("DataCollection"),b=k("XLayout"),c=k("XAction"),w=k("XBadge"),Q=k("XCopyButton"),_=k("XDl"),A=k("DataSource"),U=k("DataLoader"),W=k("XAboutCard"),Y=k("XEmptyState"),L=k("XCard"),h=k("XDrawer"),tt=k("RouterView"),et=k("AppView"),at=k("RouteView");return o(),m(at,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:a(({route:v,t:p,can:q,uri:O})=>[n(A,{src:O(D(dt),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[v.params.proxyType]??"dataplane",name:v.params.proxy,mesh:v.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:z,error:j,refresh:nt})=>[n(et,{notifications:!0},{default:a(()=>[(o(!0),i(u,null,x([{bool:l.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:l.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:l.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:l.data.dataplaneInsight.version?.envoy.version??"",kumaDp:l.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(q("use zones")&&l.data.zone&&l.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:l.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:l.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:l.data.isCertExpired,key:"certificate-expired"},{bool:!l.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:l.data.dataplane.networking.gateway?.type!=="BUILTIN"&&!q("use transparent-proxying",l.data),key:"networking-transparent-proxying",variant:"info"}],({bool:r,key:f,params:N,variant:E})=>(o(),m(S,{key:f,notify:r,"data-testid":`warning-${f}`,uri:`data-planes.notifications.${f}.${l.data.id}`,variant:E},{default:a(()=>[n(R,{path:`data-planes.notifications.${f}`,params:Object.fromEntries(Object.entries(N??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[71]||(t[71]=e()),n(b,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(W,{title:p("data-planes.routes.item.about.title"),created:l.data.creationTime,modified:l.data.modificationTime,class:"about-section","data-testid":"dataplane-about-section"},{default:a(()=>[n(U,{data:[z]},{default:a(()=>[n(b,null,{default:a(()=>[n(_,{variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(p("http.api.property.status")),1),t[2]||(t[2]=e()),s("dd",null,[n(b,{type:"separated"},{default:a(()=>[n(lt,{status:l.data.status},null,8,["status"]),t[1]||(t[1]=e()),n(M,{items:l.data.dataplane.networking.inbounds,predicate:r=>r.state!=="Ready",empty:!1},{default:a(({items:r})=>[n(B,{name:"info"},{default:a(()=>[s("ul",null,[(o(!0),i(u,null,x(r,f=>(o(),i("li",{key:`${f.service}:${f.port}`},d(p("data-planes.routes.item.unhealthy_inbound",{port:f.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[9]||(t[9]=e()),q("use zones")&&l.data.zone?(o(),i("div",vt,[s("dt",null,d(p("http.api.property.zone")),1),t[3]||(t[3]=e()),s("dd",null,[n(w,{appearance:"decorative"},{default:a(()=>[n(c,{to:{name:"zone-cp-detail-view",params:{zone:l.data.zone}}},{default:a(()=>[e(d(l.data.zone),1)]),_:1},8,["to"])]),_:1})])])):g("",!0),t[10]||(t[10]=e()),s("div",null,[s("dt",null,d(p("http.api.property.type")),1),t[4]||(t[4]=e()),s("dd",null,[n(w,{appearance:"decorative"},{default:a(()=>[e(d(p(`data-planes.type.${l.data.dataplaneType}`)),1)]),_:2},1024)])]),t[11]||(t[11]=e()),l.data.namespace.length>0?(o(),i("div",kt,[s("dt",null,d(p("http.api.property.namespace")),1),t[5]||(t[5]=e()),s("dd",null,[n(w,{appearance:"decorative"},{default:a(()=>[e(d(l.data.namespace),1)]),_:1})])])):g("",!0),t[12]||(t[12]=e()),s("div",null,[s("dt",null,d(p("http.api.property.address")),1),t[6]||(t[6]=e()),s("dd",null,[n(Q,{variant:"badge",format:"default",text:`${l.data.dataplane.networking.address}`},null,8,["text"])])]),t[13]||(t[13]=e()),l.data.dataplane.networking.gateway?(o(),i("div",gt,[s("dt",null,d(p("http.api.property.tags")),1),t[7]||(t[7]=e()),s("dd",null,[n(yt,{tags:l.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):g("",!0),t[14]||(t[14]=e()),(o(!0),i(u,null,x([Object.entries(l.data.labels)],r=>(o(),i(u,{key:typeof r},[r.length>0?(o(),i("div",bt,[s("dt",null,d(p("data-planes.routes.item.labels")),1),t[8]||(t[8]=e()),s("dd",null,[n(b,{variant:"separated",truncate:""},{default:a(()=>[(o(),i(u,null,x([/^(.+\.)?kuma\.io\//],f=>(o(),i(u,{key:typeof f},[(o(!0),i(u,null,x(r,([N,E])=>(o(),m(w,{key:N,appearance:f.test(N)?"info":"decorative"},{default:a(()=>[e(d(N)+":"+d(E),1)]),_:2},1032,["appearance"]))),128))],64))),64))]),_:2},1024)])])):g("",!0)],64))),128))]),_:2},1024),t[35]||(t[35]=e()),l.data.dataplaneInsight.mTLS?(o(),m(b,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[s("h3",null,d(p("data-planes.routes.item.mtls.title")),1),t[26]||(t[26]=e()),n(b,{size:"small"},{default:a(()=>[(o(!0),i(u,null,x([l.data.dataplaneInsight.mTLS],r=>(o(),i(u,{key:typeof r},[typeof r.lastCertificateRegeneration<"u"&&typeof r.certificateExpirationTime<"u"&&typeof r.issuedBackend<"u"?(o(),m(_,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.generation_time.title")),1),t[15]||(t[15]=e()),s("dd",null,[n(w,{appearance:"neutral"},{default:a(()=>[e(d(p("common.formats.datetime",{value:Date.parse(r.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[17]||(t[17]=e()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.expiration_time.title")),1),t[16]||(t[16]=e()),s("dd",null,[n(w,{appearance:"neutral"},{default:a(()=>[e(d(p("common.formats.datetime",{value:Date.parse(r.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(o(),i(u,{key:1},[n(R,{path:"data-planes.routes.item.mtls.managed_externally"}),t[19]||(t[19]=e()),typeof z?.$meta?.tls?.certificateExpirationTime<"u"?(o(),m(_,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.expiration_time.title")),1),t[18]||(t[18]=e()),s("dd",null,[n(w,{appearance:"neutral"},{default:a(()=>[e(d(p("common.formats.datetime",{value:z?.$meta?.tls?.certificateExpirationTime})),1)]),_:2},1024)])])]),_:2},1024)):g("",!0)],64)),t[25]||(t[25]=e()),n(_,{variant:"x-stack"},{default:a(()=>[typeof r.certificateRegenerations<"u"?(o(),i("div",xt,[s("dt",null,d(p("data-planes.routes.item.mtls.regenerations.title")),1),t[20]||(t[20]=e()),s("dd",null,[n(w,{appearance:"info"},{default:a(()=>[e(d(p("common.formats.integer",{value:r.certificateRegenerations})),1)]),_:2},1024)])])):g("",!0),t[23]||(t[23]=e()),typeof r.issuedBackend<"u"?(o(),i("div",wt,[s("dt",null,d(p("data-planes.routes.item.mtls.issued_backend.title")),1),t[21]||(t[21]=e()),s("dd",null,[n(w,{appearance:"decorative"},{default:a(()=>[e(d(r.issuedBackend),1)]),_:2},1024)])])):g("",!0),t[24]||(t[24]=e()),typeof r.supportedBackends<"u"?(o(),i("div",Ct,[s("dt",null,d(p("data-planes.routes.item.mtls.supported_backends.title")),1),t[22]||(t[22]=e()),s("dd",null,[n(b,{type:"separated",truncate:""},{default:a(()=>[(o(!0),i(u,null,x(r.supportedBackends,f=>(o(),m(w,{key:f,appearance:f===r.issuedBackend?"decorative":"info"},{default:a(()=>[e(d(f),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):g("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):g("",!0),t[36]||(t[36]=e()),l.data.dataplaneInsight.subscriptions.length>0?(o(),m(b,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(b,{type:"separated"},{default:a(()=>[s("h3",null,d(p("data-planes.routes.item.subscriptions.title")),1),t[27]||(t[27]=e()),n(c,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:v.params.mesh,proxy:v.params.proxy},query:{inactive:v.params.inactive}}},{default:a(()=>[e(`
                      (`+d(p("data-planes.routes.item.xds.show-details"))+`)
                    `,1)]),_:2},1032,["to"])]),_:2},1024),t[33]||(t[33]=e()),l.data.dataplaneInsight.connectedSubscription?(o(),m(_,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.connected")),1),t[28]||(t[28]=e()),s("dd",null,[n(w,{appearance:"neutral"},{default:a(()=>[e(d(p("common.formats.datetime",{value:Date.parse(l.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[31]||(t[31]=e()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.instance")),1),t[29]||(t[29]=e()),s("dd",null,[n(w,null,{default:a(()=>[e(d(l.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[32]||(t[32]=e()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.version")),1),t[30]||(t[30]=e()),s("dd",null,[n(w,null,{default:a(()=>[e(d(l.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??p("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(o(),m(R,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):g("",!0),t[37]||(t[37]=e()),q("use unified-resource-naming",{mesh:l.mesh,dataplaneOverview:l.data})?(o(),m(A,{key:2,src:O(D(rt),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:v.params.mesh,name:v.params.proxy}),onChange:t[0]||(t[0]=r=>V.value=r)},{default:a(()=>[V.value?.policies.length?(o(),m(b,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[s("h3",null,d(p("data-planes.routes.item.policies")),1),t[34]||(t[34]=e()),n(b,{type:"separated"},{default:a(()=>[(o(!0),i(u,null,x(V.value?.policies,r=>(o(),m(c,{key:r.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:v.params.mesh,proxy:v.params.proxy,policy:r.kind.toLowerCase()}}},{default:a(()=>[n(w,null,{default:a(()=>[e(d(r.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1032,["src"])):g("",!0)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["title","created","modified"]),t[70]||(t[70]=e()),n(A,{src:O(D(pt),"/resources",{})},{default:a(({result:r})=>[n(A,{src:O(D(ut),"/meshes/:mesh/dataplanes/:name/layout",{mesh:v.params.mesh,name:v.params.proxy})},{default:a(({data:f,refresh:N,error:E})=>[n(S,{notify:!!j,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${l.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.stats-not-enhanced",params:{error:j?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[68]||(t[68]=e()),n(L,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(U,{data:[f,z,r]},{default:a(()=>[n(b,{type:"columns"},{default:a(()=>[n(H,null,{title:a(()=>[n(b,{type:"separated"},{default:a(()=>[n(B,{name:"inbound"}),t[38]||(t[38]=e()),t[39]||(t[39]=s("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[42]||(t[42]=e()),(o(!0),i(u,null,x([Object.groupBy(l.data.dataplane.networking.inbounds,X=>X.port)],(X,C)=>(o(),i(u,{key:C},[(o(!0),i(u,null,x([f.inbounds],y=>(o(),m(F,{key:typeof y,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(b,{type:"stack",size:"small"},{default:a(()=>[(o(!0),i(u,null,x(y,I=>(o(),i(u,{key:`${I.kri}`},[(o(!0),i(u,null,x([X[I.port]?.[0]],T=>(o(),m(Z,{key:T?.port,"data-testid":"dataplane-inbound",protocol:I.protocol,"port-name":T?.portName,traffic:z?.inbounds[I.stat_prefix],"data-actionable":""},{state:a(()=>[T?.state!=="Ready"?(o(),m(B,{key:0,name:"danger",size:D(P),placement:"right"},{default:a(()=>[e(d(p("data-planes.routes.item.unhealthy_inbound",{port:T?.port})),1)]),_:2},1032,["size"])):(o(!0),i(u,{key:1},x([z?.inbounds[I.stat_prefix]?.$meta.alerts.reports??[]],$=>(o(),i(u,{key:typeof $},[n(S,{notify:$.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${l.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[40]||(t[40]=e()),$.length?(o(),m(c,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:I.stat_prefix},query:{codeSearch:$.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n(B,{name:"warning",size:D(P),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:a(()=>[t[41]||(t[41]=e()),n(c,{"data-action":"",to:{name:($=>$.includes("bound")?$.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(D(K).name)),params:{connection:I.proxyResourceName},query:{inactive:v.params.inactive}}},{default:a(()=>[e(`
                                      :`+d(I.port),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[67]||(t[67]=e()),n(H,null,{actions:a(()=>[n(c,{action:"refresh",appearance:"primary",onClick:()=>{N(),nt()}},{default:a(()=>[...t[43]||(t[43]=[e(`
                          Refresh
                        `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[n(b,{type:"separated"},{default:a(()=>[n(B,{name:"outbound"}),t[44]||(t[44]=e()),t[45]||(t[45]=s("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[65]||(t[65]=e()),t[66]||(t[66]=e()),typeof E>"u"&&typeof j>"u"&&f?.outbounds.length?(o(),i(u,{key:0},[n(F,{type:"passthrough"},{default:a(()=>[n(Z,{protocol:"passthrough",traffic:z?.passthrough},{default:a(()=>[...t[46]||(t[46]=[e(`
                            Non mesh traffic
                          `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[64]||(t[64]=e()),n(M,{type:"outbounds",items:f?.outbounds},{default:a(({items:X})=>[n(F,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[n(b,{type:"stack",size:"small"},{default:a(()=>[(o(!0),i(u,null,x(X,C=>(o(),m(Z,{key:C.kri,"data-testid":"dataplane-outbound",protocol:C.protocol,traffic:z?.outbounds[C.kri],kri:C.kri,"data-actionable":""},{state:a(()=>[(o(!0),i(u,null,x([z?.outbounds[C.proxyResourceName]?.$meta.alerts.reports??[]],y=>(o(),i(u,{key:typeof y},[n(S,{notify:y.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${l.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[47]||(t[47]=e()),y.length?(o(),m(c,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:C.proxyResourceName},query:{codeSearch:y.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n(B,{name:"warning",size:D(P),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),body:a(()=>[(o(!0),i(u,null,x([D(G).fromString(C.proxyResourceName)],y=>(o(),m(_,{key:typeof y},{default:a(()=>[s("div",null,[t[48]||(t[48]=s("dt",null,"Mesh",-1)),t[49]||(t[49]=e()),s("dd",null,d(y.mesh),1)]),t[58]||(t[58]=e()),y.zone.length>0?(o(),i("div",Dt,[t[50]||(t[50]=s("dt",null,"Zone",-1)),t[51]||(t[51]=e()),s("dd",null,d(y.zone),1)])):g("",!0),t[59]||(t[59]=e()),y.namespace.length>0?(o(),i("div",It,[t[52]||(t[52]=s("dt",null,"Namespace",-1)),t[53]||(t[53]=e()),s("dd",null,d(y.namespace),1)])):g("",!0),t[60]||(t[60]=e()),s("div",null,[t[54]||(t[54]=s("dt",null,"Port",-1)),t[55]||(t[55]=e()),s("dd",null,d(`${C.port}${C.portName?` (${C.portName})`:""}`),1)]),t[61]||(t[61]=e()),s("div",null,[t[56]||(t[56]=s("dt",null,"Type",-1)),t[57]||(t[57]=e()),r instanceof Error?(o(),i("dd",Xt,d(y.shortName),1)):(o(),i("dd",zt,d(r?.resources.find(I=>I.shortName===y.shortName)?.name??y.shortName),1))])]),_:2},1024))),128))]),default:a(()=>[t[62]||(t[62]=e()),n(c,{"data-action":"",to:{name:(y=>y.includes("bound")?y.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(D(K).name)),params:{connection:C.proxyResourceName},query:{inactive:v.params.inactive}}},{default:a(()=>[e(d(D(G).fromString(C.proxyResourceName).name),1)]),_:2},1032,["to"]),t[63]||(t[63]=e())]),_:2},1032,["protocol","traffic","kri"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),m(Y,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[69]||(t[69]=e()),n(tt,null,{default:a(X=>[X.route.name!==v.name?(o(),m(h,{key:0,width:"670px",onClose:()=>{v.replace({name:"data-plane-detail-view",params:{mesh:v.params.mesh,proxy:v.params.proxy},query:{inactive:v.params.inactive?null:void 0}})}},{default:a(()=>[(o(),m(mt(X.Component),{data:X.route.name.includes("-inbound-")?f?.inbounds:f?.outbounds,"data-plane-overview":l.data,networking:l.data.dataplane.networking,policies:V.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):g("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),_t=ft(ct,[["__scopeId","data-v-0bee345b"]]);export{_t as default};
