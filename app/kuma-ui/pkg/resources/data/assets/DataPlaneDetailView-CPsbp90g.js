import{d as nt,a1 as ot,r as y,p as m,o,w as e,b as n,m as D,a2 as st,c as r,e as a,L as u,M as x,q as g,l as s,t as d,S as it,v as dt,F as lt,Z as rt,a3 as j,a8 as U,y as pt,_ as ut}from"./index-D9fsUKAU.js";import{T as mt}from"./TagList-s_5JxIRL.js";import{C as G,a as F,b as P}from"./ConnectionTraffic-rkbyvJAn.js";const ft={key:0},yt={key:1},vt={key:2},kt={key:0},gt={key:0},bt={key:1},xt={key:2},wt={key:0},Ct={key:1},ct=nt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(H){const Z=ot(),i=H,V=dt();return(Dt,t)=>{const R=y("XI18n"),E=y("XNotification"),B=y("XIcon"),K=y("DataCollection"),b=y("XLayout"),z=y("XAction"),w=y("XBadge"),J=y("XCopyButton"),_=y("XDl"),T=y("DataSource"),M=y("DataLoader"),Q=y("XAboutCard"),W=y("XEmptyState"),Y=y("XCard"),L=y("XDrawer"),h=y("RouterView"),tt=y("AppView"),at=y("RouteView");return o(),m(at,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:e(({route:f,t:p,can:S,uri:q})=>[n(T,{src:q(D(st),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[f.params.proxyType]??"dataplane",name:f.params.proxy,mesh:f.params.mesh||"*",socketAddress:"self_inbound"})},{default:e(({data:I,error:O,refresh:et})=>[n(tt,{notifications:!0},{default:e(()=>[(o(!0),r(u,null,x([{bool:i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:i.data.dataplaneInsight.version?.envoy.version??"",kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(S("use zones")&&i.data.zone&&i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:i.data.isCertExpired,key:"certificate-expired"},{bool:!i.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:i.data.dataplane.networking.gateway?.type!=="BUILTIN"&&!S("use transparent-proxying",i.data),key:"networking-transparent-proxying",variant:"info"}],({bool:l,key:v,params:$,variant:c})=>(o(),m(E,{key:v,notify:l,"data-testid":`warning-${v}`,uri:`data-planes.notifications.${v}.${i.data.id}`,variant:c},{default:e(()=>[n(R,{path:`data-planes.notifications.${v}`,params:Object.fromEntries(Object.entries($??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[68]||(t[68]=a()),n(b,{type:"stack","data-testid":"dataplane-details"},{default:e(()=>[n(Q,{title:p("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime,class:"about-section","data-testid":"dataplane-about-section"},{default:e(()=>[n(M,{data:[I]},{default:e(()=>[n(b,null,{default:e(()=>[n(_,{variant:"x-stack"},{default:e(()=>[s("div",null,[s("dt",null,d(p("http.api.property.status")),1),t[2]||(t[2]=a()),s("dd",null,[n(b,{type:"separated"},{default:e(()=>[n(it,{status:i.data.status},null,8,["status"]),t[1]||(t[1]=a()),n(K,{items:i.data.dataplane.networking.inbounds,predicate:l=>l.state!=="Ready",empty:!1},{default:e(({items:l})=>[n(B,{name:"info"},{default:e(()=>[s("ul",null,[(o(!0),r(u,null,x(l,v=>(o(),r("li",{key:`${v.service}:${v.port}`},d(p("data-planes.routes.item.unhealthy_inbound",{port:v.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[9]||(t[9]=a()),S("use zones")&&i.data.zone?(o(),r("div",ft,[s("dt",null,d(p("http.api.property.zone")),1),t[3]||(t[3]=a()),s("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[n(z,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:e(()=>[a(d(i.data.zone),1)]),_:1},8,["to"])]),_:1})])])):g("",!0),t[10]||(t[10]=a()),s("div",null,[s("dt",null,d(p("http.api.property.type")),1),t[4]||(t[4]=a()),s("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(p(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)])]),t[11]||(t[11]=a()),i.data.namespace.length>0?(o(),r("div",yt,[s("dt",null,d(p("http.api.property.namespace")),1),t[5]||(t[5]=a()),s("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(i.data.namespace),1)]),_:1})])])):g("",!0),t[12]||(t[12]=a()),s("div",null,[s("dt",null,d(p("http.api.property.address")),1),t[6]||(t[6]=a()),s("dd",null,[n(J,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])])]),t[13]||(t[13]=a()),i.data.dataplane.networking.gateway?(o(),r("div",vt,[s("dt",null,d(p("http.api.property.tags")),1),t[7]||(t[7]=a()),s("dd",null,[n(mt,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):g("",!0),t[14]||(t[14]=a()),(o(!0),r(u,null,x([Object.entries(i.data.labels)],l=>(o(),r(u,{key:typeof l},[l.length>0?(o(),r("div",kt,[s("dt",null,d(p("data-planes.routes.item.labels")),1),t[8]||(t[8]=a()),s("dd",null,[n(b,{variant:"separated",truncate:""},{default:e(()=>[(o(),r(u,null,x([/^(.+\.)?kuma\.io\//],v=>(o(),r(u,{key:typeof v},[(o(!0),r(u,null,x(l,([$,c])=>(o(),m(w,{key:$,appearance:v.test($)?"info":"decorative"},{default:e(()=>[a(d($)+":"+d(c),1)]),_:2},1032,["appearance"]))),128))],64))),64))]),_:2},1024)])])):g("",!0)],64))),128))]),_:2},1024),t[35]||(t[35]=a()),i.data.dataplaneInsight.mTLS?(o(),m(b,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:e(()=>[s("h3",null,d(p("data-planes.routes.item.mtls.title")),1),t[26]||(t[26]=a()),n(b,{size:"small"},{default:e(()=>[(o(!0),r(u,null,x([i.data.dataplaneInsight.mTLS],l=>(o(),r(u,{key:typeof l},[typeof l.lastCertificateRegeneration<"u"&&typeof l.certificateExpirationTime<"u"&&typeof l.issuedBackend<"u"?(o(),m(_,{key:0,variant:"x-stack"},{default:e(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.generation_time.title")),1),t[15]||(t[15]=a()),s("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(p("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[17]||(t[17]=a()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.expiration_time.title")),1),t[16]||(t[16]=a()),s("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(p("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(o(),r(u,{key:1},[n(R,{path:"data-planes.routes.item.mtls.managed_externally"}),t[19]||(t[19]=a()),typeof I?.$meta?.tls?.certificateExpirationTime<"u"?(o(),m(_,{key:0,variant:"x-stack"},{default:e(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.mtls.expiration_time.title")),1),t[18]||(t[18]=a()),s("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(p("common.formats.datetime",{value:I?.$meta?.tls?.certificateExpirationTime})),1)]),_:2},1024)])])]),_:2},1024)):g("",!0)],64)),t[25]||(t[25]=a()),n(_,{variant:"x-stack"},{default:e(()=>[typeof l.certificateRegenerations<"u"?(o(),r("div",gt,[s("dt",null,d(p("data-planes.routes.item.mtls.regenerations.title")),1),t[20]||(t[20]=a()),s("dd",null,[n(w,{appearance:"info"},{default:e(()=>[a(d(p("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024)])])):g("",!0),t[23]||(t[23]=a()),typeof l.issuedBackend<"u"?(o(),r("div",bt,[s("dt",null,d(p("data-planes.routes.item.mtls.issued_backend.title")),1),t[21]||(t[21]=a()),s("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(l.issuedBackend),1)]),_:2},1024)])])):g("",!0),t[24]||(t[24]=a()),typeof l.supportedBackends<"u"?(o(),r("div",xt,[s("dt",null,d(p("data-planes.routes.item.mtls.supported_backends.title")),1),t[22]||(t[22]=a()),s("dd",null,[n(b,{type:"separated",truncate:""},{default:e(()=>[(o(!0),r(u,null,x(l.supportedBackends,v=>(o(),m(w,{key:v,appearance:v===l.issuedBackend?"decorative":"info"},{default:e(()=>[a(d(v),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):g("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):g("",!0),t[36]||(t[36]=a()),i.data.dataplaneInsight.subscriptions.length>0?(o(),m(b,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:e(()=>[n(b,{type:"separated"},{default:e(()=>[s("h3",null,d(p("data-planes.routes.item.subscriptions.title")),1),t[27]||(t[27]=a()),n(z,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive}}},{default:e(()=>[a(`
                      (`+d(p("data-planes.routes.item.xds.show-details"))+`)
                    `,1)]),_:2},1032,["to"])]),_:2},1024),t[33]||(t[33]=a()),i.data.dataplaneInsight.connectedSubscription?(o(),m(_,{key:0,variant:"x-stack"},{default:e(()=>[s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.connected")),1),t[28]||(t[28]=a()),s("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(p("common.formats.datetime",{value:Date.parse(i.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[31]||(t[31]=a()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.instance")),1),t[29]||(t[29]=a()),s("dd",null,[n(w,null,{default:e(()=>[a(d(i.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[32]||(t[32]=a()),s("div",null,[s("dt",null,d(p("data-planes.routes.item.xds.version")),1),t[30]||(t[30]=a()),s("dd",null,[n(w,null,{default:e(()=>[a(d(i.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??p("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(o(),m(R,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):g("",!0),t[37]||(t[37]=a()),S("use unified-resource-naming",{mesh:i.mesh,dataplaneOverview:i.data})?(o(),m(T,{key:2,src:q(D(lt),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:f.params.mesh,name:f.params.proxy}),onChange:t[0]||(t[0]=l=>V.value=l)},{default:e(()=>[V.value?.policies.length?(o(),m(b,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:e(()=>[s("h3",null,d(p("data-planes.routes.item.policies")),1),t[34]||(t[34]=a()),n(b,{type:"separated"},{default:e(()=>[(o(!0),r(u,null,x(V.value?.policies,l=>(o(),m(z,{key:l.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:f.params.mesh,proxy:f.params.proxy,policy:l.kind.toLowerCase()}}},{default:e(()=>[n(w,null,{default:e(()=>[a(d(l.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1032,["src"])):g("",!0)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["title","created","modified"]),t[67]||(t[67]=a()),n(T,{src:q(D(rt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:f.params.mesh,name:f.params.proxy})},{default:e(({data:l,refresh:v,error:$})=>[n(E,{notify:!!O,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.stats-not-enhanced",params:{error:O?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[65]||(t[65]=a()),n(Y,{class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[n(M,{data:[l,I]},{default:e(()=>[n(b,{type:"columns"},{default:e(()=>[n(G,null,{title:e(()=>[n(b,{type:"separated"},{default:e(()=>[n(B,{name:"inbound"}),t[38]||(t[38]=a()),t[39]||(t[39]=s("span",null,"Inbounds",-1))]),_:1})]),default:e(()=>[t[42]||(t[42]=a()),(o(!0),r(u,null,x([Object.groupBy(i.data.dataplane.networking.inbounds,c=>c.port)],(c,C)=>(o(),r(u,{key:C},[(o(!0),r(u,null,x([l.inbounds],k=>(o(),m(F,{key:typeof k,type:"inbound","data-testid":"dataplane-inbounds"},{default:e(()=>[n(b,{type:"stack",size:"small"},{default:e(()=>[(o(!0),r(u,null,x(k,X=>(o(),r(u,{key:`${X.kri}`},[(o(!0),r(u,null,x([c[X.port]?.[0]],A=>(o(),m(P,{key:A?.port,"data-testid":"dataplane-inbound",protocol:X.protocol,"port-name":A?.portName,traffic:I?.inbounds[X.stat_prefix],"data-actionable":""},{state:e(()=>[A?.state!=="Ready"?(o(),m(B,{key:0,name:"danger",size:D(j),placement:"right"},{default:e(()=>[a(d(p("data-planes.routes.item.unhealthy_inbound",{port:A?.port})),1)]),_:2},1032,["size"])):(o(!0),r(u,{key:1},x([I?.inbounds[X.stat_prefix]?.$meta.alerts.reports??[]],N=>(o(),r(u,{key:typeof N},[n(E,{notify:N.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[40]||(t[40]=a()),N.length?(o(),m(z,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:X.stat_prefix},query:{codeSearch:N.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:e(()=>[n(B,{name:"warning",size:D(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:e(()=>[t[41]||(t[41]=a()),n(z,{"data-action":"",to:{name:(N=>N.includes("bound")?N.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(D(Z).name)),params:{connection:X.proxyResourceName},query:{inactive:f.params.inactive}}},{default:e(()=>[a(`
                                    :`+d(X.port),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[64]||(t[64]=a()),n(G,null,{actions:e(()=>[n(z,{action:"refresh",appearance:"primary",onClick:()=>{v(),et()}},{default:e(()=>[...t[43]||(t[43]=[a(`
                        Refresh
                      `,-1)])]),_:1},8,["onClick"])]),title:e(()=>[n(b,{type:"separated"},{default:e(()=>[n(B,{name:"outbound"}),t[44]||(t[44]=a()),t[45]||(t[45]=s("span",null,"Outbounds",-1))]),_:1})]),default:e(()=>[t[62]||(t[62]=a()),t[63]||(t[63]=a()),typeof $>"u"&&typeof O>"u"&&l?.outbounds.length?(o(),r(u,{key:0},[n(F,{type:"passthrough"},{default:e(()=>[n(P,{protocol:"passthrough",traffic:I?.passthrough},{default:e(()=>[...t[46]||(t[46]=[a(`
                          Non mesh traffic
                        `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[61]||(t[61]=a()),n(K,{type:"outbounds",items:l?.outbounds},{default:e(({items:c})=>[n(F,{type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[n(b,{type:"stack",size:"small"},{default:e(()=>[(o(!0),r(u,null,x(c,C=>(o(),m(P,{key:C.kri,"data-testid":"dataplane-outbound",protocol:C.protocol,traffic:I?.outbounds[C.kri],kri:C.kri,"data-actionable":""},{state:e(()=>[(o(!0),r(u,null,x([I?.outbounds[C.proxyResourceName]?.$meta.alerts.reports??[]],k=>(o(),r(u,{key:typeof k},[n(E,{notify:k.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[47]||(t[47]=a()),k.length?(o(),m(z,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:C.proxyResourceName},query:{codeSearch:k.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:e(()=>[n(B,{name:"warning",size:D(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),body:e(()=>[(o(!0),r(u,null,x([D(U).fromString(C.proxyResourceName)],k=>(o(),m(_,{key:typeof k},{default:e(()=>[s("div",null,[t[48]||(t[48]=s("dt",null,"Mesh",-1)),t[49]||(t[49]=a()),s("dd",null,d(k.mesh),1)]),t[56]||(t[56]=a()),k.zone.length>0?(o(),r("div",wt,[t[50]||(t[50]=s("dt",null,"Zone",-1)),t[51]||(t[51]=a()),s("dd",null,d(k.zone),1)])):g("",!0),t[57]||(t[57]=a()),k.namespace.length>0?(o(),r("div",Ct,[t[52]||(t[52]=s("dt",null,"Namespace",-1)),t[53]||(t[53]=a()),s("dd",null,d(k.namespace),1)])):g("",!0),t[58]||(t[58]=a()),s("div",null,[t[54]||(t[54]=s("dt",null,"Port",-1)),t[55]||(t[55]=a()),s("dd",null,d(`${C.port}${C.portName?` (${C.portName})`:""}`),1)])]),_:2},1024))),128))]),default:e(()=>[t[59]||(t[59]=a()),n(z,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(D(Z).name)),params:{connection:C.proxyResourceName},query:{inactive:f.params.inactive}}},{default:e(()=>[a(d(D(U).fromString(C.proxyResourceName).name),1)]),_:2},1032,["to"]),t[60]||(t[60]=a())]),_:2},1032,["protocol","traffic","kri"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),m(W,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[66]||(t[66]=a()),n(h,null,{default:e(c=>[c.route.name!==f.name?(o(),m(L,{key:0,width:"670px",onClose:()=>{f.replace({name:"data-plane-detail-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive?null:void 0}})}},{default:e(()=>[(o(),m(pt(c.Component),{data:c.route.name.includes("-inbound-")?l?.inbounds:l?.outbounds,"data-plane-overview":i.data,networking:i.data.dataplane.networking,policies:V.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):g("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),$t=ut(ct,[["__scopeId","data-v-4a848b00"]]);export{$t as default};
